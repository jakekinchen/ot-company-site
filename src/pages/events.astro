---
import Layout from '../components/Layout.astro';
import { getCollection } from 'astro:content';
import type { Event } from '../types';

const events = await getCollection('events') as Event[];
const sortedEvents = events.sort((a: Event, b: Event) => a.data.eventDate.getTime() - b.data.eventDate.getTime());
const eventTypes = ['All', 'Webinar', 'Out and About', 'Conference', 'Exposition'] as const;
---

<Layout headerLogoColor='blue' headerIconColor='blue' headerBackground='bg-white' gradient={true}>
  <section class="bg-white py-16 text-blue">
    <div class="custom-container dt:w-[75%] mb:w-[90%] mx-auto">
      <h1 class="text-5xl text-blue font-bold mb:text-center mb-12">Events</h1>
      <div class="flex mb-8 mb:mx-auto dt:justify-start justify-center">
        <div class="filter-buttons-container flex">
          <span class="mr-4 mt-2">Filter:</span>
          <div class="filter-buttons flex flex-wrap">
            {eventTypes.map(type => (
              <button class="filter-btn bg-blue text-white hover:text-white px-4 py-2 rounded-full mr-2 mb-2" data-type={type}>{type}</button>
            ))}
          </div>
        </div>
      </div>
      <div id="events-grid" class="grid mb:grid-cols-1 dt:grid-cols-3 gap-8 mx-auto text-white">
        {sortedEvents.map(event => (
          <div class="event-card bg-light-blue rounded-xl p-6" data-category={event.data.category}>
            <h2 class="text-2xl font-bold mb-2 text-white">
              {event.data.eventDate.toLocaleString('default', { month: 'short' })} {event.data.eventDate.getDate()}
            </h2>
            <p class="text-lg mb-2">{event.data.title}</p>
            <p class="text-lg">{event.data.category}</p>
          </div>
        ))}
      </div>
      <div class="flex justify-center mt-8">
        <button class="mr-4 font-bold text-4xl hover:scale-110">&lt;</button>
        <button class="font-bold text-4xl hover:scale-110">&gt;</button>
      </div>
    </div>
  </section>
</Layout>

<style>
  .filter-buttons button {
    transition: background-color 0.3s ease;
  }
  .filter-buttons button:hover {
    background-color: var(--light-blue);
    color: var(--white);
  }
  #events-grid {
    min-height: 600px;
  }
  .filter-btn.active {
    background-color: var(--blue);
    color: var(--white);
  }
  .filter-btn:not(.active) {
    background-color: var(--white);
    color: var(--blue);
    border: 1px solid var(--blue);
  }


</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const filterButtons = document.querySelectorAll('.filter-btn');
    const eventCards = document.querySelectorAll('.event-card');
  
    filterButtons.forEach(button => {
      button.addEventListener('click', () => {
        const filterType = button.getAttribute('data-type');
  
        // Toggle active class for buttons
        filterButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
  
        // Filter events
        eventCards.forEach(card => {
          if (card instanceof HTMLElement) {  // Type assertion
            if (filterType === 'All' || card.getAttribute('data-category') === filterType) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          }
        });
      });
    });
  
    // Set 'All' as default active filter
    const allButton = document.querySelector('.filter-btn[data-type="All"]');
    if (allButton instanceof HTMLElement) {  // Type assertion
      allButton.classList.add('active');
    }
  });
  </script>